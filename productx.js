const generateUuid=function(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},setSessionCookie=function(e,i){document.cookie=e+"="+i+";"},getSessionCookie=function(e){let i=e+"=",t=document.cookie.split(";");for(let s=0;s<t.length;s++){let n=t[s];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(i)){let r=n.substring(i.length,n.length);if("NaN"!=r&&"null"!=r)return r;break}}return null},setStorage=function(e,i){localStorage.setItem(e,i)},getStorage=function(e){return localStorage.getItem(e)};let TimeMe={startStopTimes:{},idleTimeoutMs:3e4,currentIdleTimeMs:0,checkIdleStateRateMs:250,isUserCurrentlyOnPage:!0,isUserCurrentlyIdle:!1,currentPageName:"default-page-name",timeElapsedCallbacks:[],userLeftCallbacks:[],userReturnCallbacks:[],trackTimeOnElement(e){let i=document.getElementById(e);i&&(i.addEventListener("mouseover",()=>{TimeMe.startTimer(e)}),i.addEventListener("mousemove",()=>{TimeMe.startTimer(e)}),i.addEventListener("mouseleave",()=>{TimeMe.stopTimer(e)}),i.addEventListener("keypress",()=>{TimeMe.startTimer(e)}),i.addEventListener("focus",()=>{TimeMe.startTimer(e)}))},getTimeOnElementInSeconds(e){let i=TimeMe.getTimeOnPageInSeconds(e);return i||0},startTimer(e,i){if(e||(e=TimeMe.currentPageName),void 0===TimeMe.startStopTimes[e])TimeMe.startStopTimes[e]=[];else{let t=TimeMe.startStopTimes[e],s=t[t.length-1];if(void 0!==s&&void 0===s.stopTime)return}TimeMe.startStopTimes[e].push({startTime:i||new Date,stopTime:void 0})},stopAllTimers(){let e=Object.keys(TimeMe.startStopTimes);for(let i=0;i<e.length;i++)TimeMe.stopTimer(e[i])},stopTimer(e,i){e||(e=TimeMe.currentPageName);let t=TimeMe.startStopTimes[e];void 0!==t&&0!==t.length&&void 0===t[t.length-1].stopTime&&(t[t.length-1].stopTime=i||new Date)},getTimeOnCurrentPageInSeconds:()=>TimeMe.getTimeOnPageInSeconds(TimeMe.currentPageName),getTimeOnPageInSeconds(e){let i=TimeMe.getTimeOnPageInMilliseconds(e);if(void 0!==i)return i/1e3},getTimeOnCurrentPageInMilliseconds:()=>TimeMe.getTimeOnPageInMilliseconds(TimeMe.currentPageName),getTimeOnPageInMilliseconds(e){let i=0,t=TimeMe.startStopTimes[e];if(void 0===t)return;let s=0;for(let n=0;n<t.length;n++){let r=t[n].startTime,a=t[n].stopTime;void 0===a&&(a=new Date);s+=a-r}return Number(s)},getTimeOnAllPagesInSeconds(){let e=[],i=Object.keys(TimeMe.startStopTimes);for(let t=0;t<i.length;t++){let s=i[t],n=TimeMe.getTimeOnPageInSeconds(s);e.push({pageName:s,timeOnPage:n})}return e},setIdleDurationInSeconds(e){let i=parseFloat(e);if(!1===isNaN(i))TimeMe.idleTimeoutMs=1e3*e;else throw{name:"InvalidDurationException",message:"An invalid duration time ("+e+") was provided."}},setCurrentPageName(e){TimeMe.currentPageName=e},resetRecordedPageTime(e){delete TimeMe.startStopTimes[e]},resetAllRecordedPageTimes(){let e=Object.keys(TimeMe.startStopTimes);for(let i=0;i<e.length;i++)TimeMe.resetRecordedPageTime(e[i])},userActivityDetected(){TimeMe.isUserCurrentlyIdle&&TimeMe.triggerUserHasReturned(),TimeMe.resetIdleCountdown()},resetIdleCountdown(){TimeMe.isUserCurrentlyIdle=!1,TimeMe.currentIdleTimeMs=0},callWhenUserLeaves(e,i){TimeMe.userLeftCallbacks.push({callback:e,numberOfTimesToInvoke:i})},callWhenUserReturns(e,i){TimeMe.userReturnCallbacks.push({callback:e,numberOfTimesToInvoke:i})},triggerUserHasReturned(){if(!TimeMe.isUserCurrentlyOnPage){TimeMe.isUserCurrentlyOnPage=!0,TimeMe.resetIdleCountdown();for(let e=0;e<TimeMe.userReturnCallbacks.length;e++){let i=TimeMe.userReturnCallbacks[e],t=i.numberOfTimesToInvoke;(isNaN(t)||void 0===t||t>0)&&(i.numberOfTimesToInvoke-=1,i.callback())}}TimeMe.startTimer()},triggerUserHasLeftPageOrGoneIdle(){if(TimeMe.isUserCurrentlyOnPage){TimeMe.isUserCurrentlyOnPage=!1;for(let e=0;e<TimeMe.userLeftCallbacks.length;e++){let i=TimeMe.userLeftCallbacks[e],t=i.numberOfTimesToInvoke;(isNaN(t)||void 0===t||t>0)&&(i.numberOfTimesToInvoke-=1,i.callback())}}TimeMe.stopAllTimers()},callAfterTimeElapsedInSeconds(e,i){TimeMe.timeElapsedCallbacks.push({timeInSeconds:e,callback:i,pending:!0})},checkIdleState(){for(let e=0;e<TimeMe.timeElapsedCallbacks.length;e++)TimeMe.timeElapsedCallbacks[e].pending&&TimeMe.getTimeOnCurrentPageInSeconds()>TimeMe.timeElapsedCallbacks[e].timeInSeconds&&(TimeMe.timeElapsedCallbacks[e].callback(),TimeMe.timeElapsedCallbacks[e].pending=!1);!1===TimeMe.isUserCurrentlyIdle&&TimeMe.currentIdleTimeMs>TimeMe.idleTimeoutMs?(TimeMe.isUserCurrentlyIdle=!0,TimeMe.triggerUserHasLeftPageOrGoneIdle()):TimeMe.currentIdleTimeMs+=TimeMe.checkIdleStateRateMs},visibilityChangeEventName:void 0,hiddenPropName:void 0,listenForVisibilityEvents(e,i){e&&TimeMe.listenForUserLeavesOrReturnsEvents(),i&&TimeMe.listForIdleEvents()},listenForUserLeavesOrReturnsEvents(){void 0!==document.hidden?(TimeMe.hiddenPropName="hidden",TimeMe.visibilityChangeEventName="visibilitychange"):void 0!==document.mozHidden?(TimeMe.hiddenPropName="mozHidden",TimeMe.visibilityChangeEventName="mozvisibilitychange"):void 0!==document.msHidden?(TimeMe.hiddenPropName="msHidden",TimeMe.visibilityChangeEventName="msvisibilitychange"):void 0!==document.webkitHidden&&(TimeMe.hiddenPropName="webkitHidden",TimeMe.visibilityChangeEventName="webkitvisibilitychange"),document.addEventListener(TimeMe.visibilityChangeEventName,()=>{document[TimeMe.hiddenPropName]?TimeMe.triggerUserHasLeftPageOrGoneIdle():TimeMe.triggerUserHasReturned()},!1),window.addEventListener("blur",()=>{TimeMe.triggerUserHasLeftPageOrGoneIdle()}),window.addEventListener("focus",()=>{TimeMe.triggerUserHasReturned()})},listForIdleEvents(){document.addEventListener("mousemove",()=>{TimeMe.userActivityDetected()}),document.addEventListener("keyup",()=>{TimeMe.userActivityDetected()}),document.addEventListener("touchstart",()=>{TimeMe.userActivityDetected()}),window.addEventListener("scroll",()=>{TimeMe.userActivityDetected()}),setInterval(()=>{!0!==TimeMe.isUserCurrentlyIdle&&TimeMe.checkIdleState()},TimeMe.checkIdleStateRateMs)},websocket:void 0,websocketHost:void 0,setUpWebsocket(e){if(window.WebSocket&&e){let i=e.websocketHost;try{TimeMe.websocket=new WebSocket(i),window.onbeforeunload=()=>{TimeMe.sendCurrentTime(e.appId)},TimeMe.websocket.onopen=()=>{TimeMe.sendInitWsRequest(e.appId)},TimeMe.websocket.onerror=e=>{console&&console.log("Error occurred in websocket connection: "+e)},TimeMe.websocket.onmessage=e=>{console&&console.log(e.data)}}catch(t){console&&console.error("Failed to connect to websocket host.  Error:"+t)}}},websocketSend(e){TimeMe.websocket.send(JSON.stringify(e))},sendCurrentTime(e){let i={type:"INSERT_TIME",appId:e,timeOnPageMs:TimeMe.getTimeOnCurrentPageInMilliseconds(),pageName:TimeMe.currentPageName};TimeMe.websocketSend(i)},sendInitWsRequest(e){TimeMe.websocketSend({type:"INIT",appId:e})},initialize(e){let i=TimeMe.idleTimeoutMs||30,t=TimeMe.currentPageName||"default-page-name",s,n,r=!0,a=!0;e&&(i=e.idleTimeoutInSeconds||i,t=e.currentPageName||t,s=e.websocketOptions,n=e.initialStartTime,!1===e.trackWhenUserLeavesPage&&(r=!1),!1===e.trackWhenUserGoesIdle&&(a=!1)),TimeMe.setIdleDurationInSeconds(i),TimeMe.setCurrentPageName(t),TimeMe.setUpWebsocket(s),TimeMe.listenForVisibilityEvents(r,a),TimeMe.startTimer(void 0,n)}};TimeMe.initialize({currentPageName:generateUuid(),idleTimeoutInSeconds:30});const checkMobile=function(){var e;let i=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(i=!0),i},getQueryParamValue=function(e){let i=new URLSearchParams(window.location.search);return i.get(e)};class FSDIngestor{constructor(e){this.clientId=e,this.urlPath=window.location.pathname,this.pageId=generateUuid(),this.isMobile=checkMobile(),this.resolution=String(parseInt(window.screen.width*window.devicePixelRatio))+"x"+String(parseInt(window.screen.height*window.devicePixelRatio)),this.uuid=null,this.sessionId=null,this.referrer=null,this.referrerHost=null,this.sessionReferrer=null,this.firstEverSession=null,this.firstEverPageview=null,this.numLifetimePageviews=null,this.numLifetimeSessions=null,this.sessionHitNum=null,this.activeLast24Hrs=null,this.activeLast7Days=null,this.timeSpent=null,this.maxDepth=null,this.eventCounts={},this.eventNames={},this.source=getQueryParamValue("utm_source"),this.campaign=getQueryParamValue("utm_campaign"),this.medium=getQueryParamValue("utm_medium")}setUserSessionId(){let e=getStorage("fsd_uuid_"+this.clientId);null==e&&(e=generateUuid(),setStorage("fsd_uuid_"+this.clientId,e)),this.uuid=e;let i=getSessionCookie("fsd_session_id_"+this.clientId);null==i&&(i=generateUuid(),setSessionCookie("fsd_session_id_"+this.clientId,i)),this.sessionId=i}setReferrerDetails(){let e=document.referrer,i;""!=e?-1!==(i=e.toString().replace(/^(.*\/\/[^\/?#]*).*$/,"$1").split("//")[1]).indexOf(".facebook.")||-1!==i.indexOf(".fb.")||0===i.indexOf("facebook.")||0===i.indexOf("fb.")?i="Facebook":-1!==i.indexOf("mail.google")||-1!==i.indexOf("gmail.com")?i="Gmail":-1!==i.indexOf(".google.")||-1!==i.indexOf(".googleusercontent.")||0===i.indexOf("google.")?i="Google":-1!==i.indexOf("reddit.com")?i="Reddit":0===i.indexOf("t.co")?i="Twitter":(0===i.indexOf("lnkd.in")||0===i.indexOf("linkedin."))&&(i="LinkedIn"):(i="direct",e="direct"),this.referrer=e,this.referrerHost=i;let t=getSessionCookie("fsd_session_referrer_"+this.clientId);null==t&&(t=i,setSessionCookie("fsd_session_referrer_"+this.clientId,t)),this.sessionReferrer=t}setLongTermUsageMetrics(){let e=getStorage("fsd_lifetime_pageviews_"+this.clientId),i=getStorage("fsd_lifetime_sessions_"+this.clientId),t=getSessionCookie("fsd_session_hit_num_"+this.clientId);null==e?(e=1,this.firstEverPageview=!0):(e=parseInt(e)+1,this.firstEverPageview=!1),setStorage("fsd_lifetime_pageviews_"+this.clientId,e),this.numLifetimePageviews=e,null==i?(i=0,this.firstEverSession=!0):0===parseInt(i)?this.firstEverSession=!0:this.firstEverSession=!1,null==t?(i=parseInt(i)+1,t=1):t=parseInt(t)+1,this.numLifetimeSessions=i,this.sessionHitNum=t,setStorage("fsd_lifetime_sessions_"+this.clientId,i),setSessionCookie("fsd_session_hit_num_"+this.clientId,t);let s=getStorage("fsd_last_active_time_"+this.clientId);null==s?(this.activeLast24Hrs=!1,this.activeLast7Days=!1):(this.activeLast24Hrs=new Date-Date.parse(s)<864e5,this.activeLast7Days=new Date-Date.parse(s)<6048e5),setStorage("fst_last_active_time_"+this.clientId,new Date().toISOString())}updateEngagementMetrics(){let e=TimeMe.getTimeOnCurrentPageInSeconds();e<0?this.timeSpent=0:e>3600?this.timeSpent=3600:this.timeSpent=e;let i=(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0)/parseInt(document.body.clientHeight);i>=this.maxDepth&&(this.maxDepth=i)}sendDataToServer(e="YOUR_URL"){console.log("send data to server");let i=JSON.stringify({clientId:this.clientId,urlPath:this.urlPath,pageId:this.pageId,isMobile:this.isMobile,resolution:this.resolution,uuid:this.uuid,sessionId:this.sessionId,referrer:this.referrer,referrerHost:this.referrerHost,sessionReferrer:this.sessionReferrer,firstEverSession:this.firstEverSession,firstEverPageview:this.firstEverPageview,numLifetimePageviews:this.numLifetimePageviews,numLifetimeSessions:this.numLifetimeSessions,sessionHitNum:this.sessionHitNum,activeLast24Hrs:this.activeLast24Hrs,activeLast7Days:this.activeLast7Days,timeSpent:this.timeSpent,maxDepth:this.maxDepth,eventCounts:this.eventCounts,eventNames:this.eventNames,source:this.source,campaign:this.campaign,medium:this.medium});fetch("https://api.ipify.org?format=json").then(e=>e.json()).then(e=>{let i=JSON.stringify({ip:e.ip,clientId:this.clientId,urlPath:this.urlPath,pageId:this.pageId,isMobile:this.isMobile,uuid:this.uuid,referrer:this.referrer,referrerHost:this.referrerHost,sessionReferrer:this.sessionReferrer,firstEverSession:this.firstEverSession,firstEverPageview:this.firstEverPageview,numLifetimePageviews:this.numLifetimePageviews,numLifetimeSessions:this.numLifetimeSessions,sessionHitNum:this.sessionHitNum,activeLast24Hrs:this.activeLast24Hrs,activeLast7Days:this.activeLast7Days,campaign:this.campaign});fetch("https://vrhnjspyczyducgjullv.supabase.co/rest/v1/events",{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZyaG5qc3B5Y3p5ZHVjZ2p1bGx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTYwMjI3NjQsImV4cCI6MjAzMTU5ODc2NH0.0viIT7e5XStqdgP7PgDf-T9xewG-RGYeMqUQHUJ9SQw",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZyaG5qc3B5Y3p5ZHVjZ2p1bGx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTYwMjI3NjQsImV4cCI6MjAzMTU5ODc2NH0.0viIT7e5XStqdgP7PgDf-T9xewG-RGYeMqUQHUJ9SQw",Prefer:"resolution=merge-duplicates"},body:i})}).catch(e=>console.error("Error getting IP address:",e)),console.log(i)}updateEventCounts(e){e in this.eventCounts?this.eventCounts[e]+=1:this.eventCounts[e]=1}updateEventNames(e,i){e in this.eventNames?this.events[e].append(i):this.events[e]=[i]}}let fsdIngestor;function fsdIngest(e){(fsdIngestor=new FSDIngestor(e)).setUserSessionId(),fsdIngestor.setReferrerDetails(),fsdIngestor.setLongTermUsageMetrics(),fsdIngestor.sendDataToServer(),window.setInterval(function(){fsdIngestor.updateEngagementMetrics()},1e3),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&fsdIngestor.sendDataToServer()}),window.addEventListener("pagehide",function(){fsdIngestor.sendDataToServer()})}function fsdUpdateEvent(e,i,t){"numeric"==t?fsdIngestor.updateEventCounts(e):"text"==t&&fsdIngestor.updateEventNames(e,i)}
